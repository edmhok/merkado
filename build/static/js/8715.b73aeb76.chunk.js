"use strict";(self.webpackChunkmerkado=self.webpackChunkmerkado||[]).push([[8715],{78715:(e,t,n)=>{n.r(t),n.d(t,{default:()=>$});var i=n(3481),o=n(54711),a=n(72296),r=n(27312),s=n(40853),c=n(52634),l=n(7745),d=n(40682),u=n(4786),p=n(20761),m=n(18938),x=n(84052),y=n(45265),h=n(8185),g=n(71007),v=n(93321),f=n(29277),k=n(41738),C=n(12852),A=n(55484),b=n(27895),R=n(86100),w=n(97704),j=n(62474),P=n(16443),_=n(65138),M=n(22631),I=n(8157),S=n(84076),B=n(5556),L=n(50620),T=n(85066),E=n(9064),q=n(10086),F=n(11967),U=n(37012);var N=n(17744),X=n(83937),z=n(22061),O=n(60816),D=n(65324);let K;function W(){const e=(0,N.KX)(),t=(0,r.W6)(),n=(0,B.Qy)(),s=()=>{t.push("/swap/reclaim"),n()},c=()=>{t.push("/swap/pcm/reclaim"),n()};return(0,a.useCallback)(((t,n)=>{let{position:a,noLiquidity:r,retry:d,pcmMetadata:u,pcmToken:p,hasPassCode:m,needPayForPCM:x}=n;const y=function(e){let{position:t,noLiquidity:n,retry:a,handleReclaim:r,handleReclaimPCMBalance:s,pcmMetadata:c,pcmToken:d,hasPassCode:u,needPayForPCM:p}=e;if(!t)return[];const{token0:m}=t.pool,{token1:x}=t.pool,y=t.pool.token0.symbol,h=t.pool.token1.symbol,g=(0,R.Vr)((0,T.t)((0,q.gz)(m,t.mintAmounts.amount0.toString()),m.decimals).toString()),v=(0,R.Vr)((0,T.t)((0,q.gz)(x,t.mintAmounts.amount1.toString()),x.decimals).toString()),f=(0,U.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[(0,U.jsx)(L.A,{sx:{width:"16px",height:"16px",margin:"0 4px 0 0"},src:t.pool.token0.logo,children:"\xa0"}),g]}),k=(0,U.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[(0,U.jsx)(L.A,{sx:{width:"16px",height:"16px",margin:"0 4px 0 0"},src:t.pool.token1.logo,children:"\xa0"}),v]}),C=[{title:(0,q.bM)(m)?"Transfer ".concat(y):"Approve ".concat(y),children:[{label:o.Ru._({id:"hehnjM"}),value:f},{label:o.Ru._({id:"bNpCwC"}),value:m.address}]},{title:o.Ru._({id:"RG6Qda",values:{symbol0:y}}),children:[{label:o.Ru._({id:"hehnjM"}),value:f},{label:o.Ru._({id:"bNpCwC"}),value:m.address}],errorActions:[(0,U.jsx)(U.Fragment,{children:(0,U.jsx)(E.QW,{onClick:r,children:(0,U.jsx)(i.x6,{id:"CkKHX6"})})})],errorMessage:o.Ru._({id:"pX/p94"})},{title:(0,q.bM)(x)?"Transfer ".concat(h):"Approve ".concat(h),children:[{label:o.Ru._({id:"hehnjM"}),value:k},{label:o.Ru._({id:"bNpCwC"}),value:x.address}]},{title:"Deposit ".concat(h),children:[{label:o.Ru._({id:"hehnjM"}),value:k},{label:o.Ru._({id:"bNpCwC"}),value:x.address}],errorActions:[(0,U.jsx)(U.Fragment,{children:(0,U.jsx)(E.QW,{onClick:r,children:(0,U.jsx)(i.x6,{id:"CkKHX6"})})})],errorMessage:o.Ru._({id:"pX/p94"})},{title:"Add liquidity ".concat(m.symbol," and ").concat(x.symbol),children:[{label:y,value:f},{label:h,value:k}],errorActions:[(0,U.jsx)(E.QW,{onClick:r,children:(0,U.jsx)(i.x6,{id:"CkKHX6"})}),(0,U.jsx)(E.QW,{onClick:a,children:(0,U.jsx)(i.x6,{id:"6gRgw8"})})],errorMessage:o.Ru._({id:"pX/p94"})}];if(n){const e=(0,T.t)(c.passcodePrice,d.decimals);C.unshift({title:"Create pool ".concat(m.symbol," and ").concat(x.symbol)}),u||(C.unshift({title:"Confirm payment and request permission"}),p&&(C.unshift({title:"Deposit ".concat(e.toFormat()," ").concat(d.symbol," for creating swap pool fee"),children:[{label:o.Ru._({id:"6Pwa9U"}),value:F.pk},{label:o.Ru._({id:"hTW9j/"}),value:"".concat(e.toFormat()," ").concat(d.symbol)}]}),C.unshift({title:(0,q.bM)(d)?"Transfer ".concat(d.symbol," for creating swap pool fee"):"Approve ".concat(d.symbol," for creating swap pool fee"),children:[{label:o.Ru._({id:"6Pwa9U"}),value:F.pk},{label:o.Ru._({id:"hehnjM"}),value:"".concat(e.toFormat()," ").concat(d.symbol)}],errorActions:[(0,U.jsx)(U.Fragment,{children:(0,U.jsx)(E.QW,{onClick:s,children:(0,U.jsx)(i.x6,{id:"CkKHX6"})})})],errorMessage:o.Ru._({id:"pX/p94"})})))}return C.filter((e=>void 0!==e)).map(((e,t)=>({...e,step:t})))}({position:a,noLiquidity:r,retry:d,handleReclaim:s,handleReclaimPCMBalance:c,pcmMetadata:u,pcmToken:p,hasPassCode:m,needPayForPCM:x});e(String(t),{content:y,title:o.Ru._({id:"fYygXf"})})}),[])}function Y(){const e=function(){const e=(0,P.Le)(),[t]=(0,A.I5)(),[n]=(0,A.dX)(),i=(0,X.QR)(),r=(0,X.Vd)(),s=(0,X.i_)(),c=(0,O.Sk)();return(0,a.useCallback)((a=>{let{noLiquidity:l,position:d,pcmMetadata:u,pcmToken:p,hasPassCode:m,openExternalTip:x,stepKey:y,needPayForPCM:h}=a;const g=()=>{var e;return l&&null!==(e=K)&&void 0!==e?e:d.pool.id};return[l&&!m&&h?async()=>(0,q.bM)(p)?await s(p,(u.passcodePrice+BigInt(p.transFee)).toString(),F.pk):await i(p,u.passcodePrice.toString(),F.pk):void 0,l&&!m&&h?async()=>await r(p,u.passcodePrice.toString(),F.pk):void 0,l&&!m?async()=>{const{token0:e,token1:t,fee:i}=d.pool,{data:a,message:r}=await(0,_.Ct)(D.p.fromText(e.address),D.p.fromText(t.address),BigInt(i));return"ok"!==a&&n(null!==r&&void 0!==r?r:o.Ru._({id:"bTT93N"})),"ok"===a}:void 0,l?async()=>{const e=await(0,j.u)(),{token0:t,token1:i,fee:o,sqrtRatioX96:a}=d.pool,{status:r,message:s,data:c}=await(0,z.b)(e,t.address,i.address,o,a.toString());return"err"!==r&&c?(K=null===c||void 0===c?void 0:c.canisterId.toString(),!0):(n(s),!1)}:void 0,(0,q.bM)(null===d||void 0===d?void 0:d.pool.token0)?async()=>{if(!d||!e)return!1;const t=g(),n=d.mintAmounts.amount0.toString();return"0"===n||await s(d.pool.token0,n,t)}:async()=>{if(!d||!e)return!1;const t=g(),n=d.mintAmounts.amount0.toString();return"0"===n||await i(d.pool.token0,n,t)},async()=>{if(!d||!e)return!1;const t=g(),n=d.mintAmounts.amount0.toString();return"0"===n||await r(d.pool.token0,n,t,(e=>{let{message:t}=e;x({message:t,tipKey:y})}))},(0,q.bM)(null===d||void 0===d?void 0:d.pool.token1)?async()=>{if(!d||!e)return!1;const t=g(),n=d.mintAmounts.amount1.toString();return"0"===n||await s(d.pool.token1,n,t)}:async()=>{if(!d||!e)return!1;const t=g(),n=d.mintAmounts.amount1.toString();return"0"===n||await i(d.pool.token1,n,t)},async()=>{if(!d||!e)return!1;const t=g(),n=d.mintAmounts.amount1.toString();return"0"===n||await r(d.pool.token1,n,t,(e=>{let{message:t}=e;x({message:t,tipKey:y})}))},async()=>{if(!d||!e)return!1;const n=g(),i=await(0,j.u)(),{token0:a}=d.pool,{token1:r}=d.pool,s=(0,q.gz)(a,d.mintAmounts.amount0.toString()),l=(0,q.gz)(r,d.mintAmounts.amount1.toString()),{status:u,message:p}=await(0,z.Xx)(n,i,{token0:a.address,token1:r.address,fee:BigInt(d.pool.fee),tickLower:BigInt(d.tickLower),tickUpper:BigInt(d.tickUpper),amount0Desired:s,amount1Desired:l});return"ok"===u?(t(o.Ru._({id:"LZeZGf"})),(0,M.dd)(n,!0),c([n]),!0):"err"===u&&(x({message:(0,S.If)(p),tipKey:y}),!1)}].filter((e=>void 0!==e))}),[e])}(),t=(0,B.TM)(),n=W();return(0,a.useCallback)((async i=>{let{position:o,noLiquidity:a,principal:r,pcmMetadata:s,pcmToken:c,openExternalTip:l,needPayForPCM:d}=i,u=!1;if(a){const e=await(0,I.Z)(r),{token0:t,token1:n,fee:i}=o.pool;u=void 0!==e.find((e=>e.token0.toString()===t.address&&e.token1.toString()===n.address&&e.fee===BigInt(i)))}const p=(0,B.Eu)(),m=e({position:o,pcmMetadata:s,pcmToken:c,hasPassCode:u,openExternalTip:l,noLiquidity:a,stepKey:p,needPayForPCM:d}),{call:x,reset:y,retry:h}=t(m,p);return n(p,{needPayForPCM:d,position:o,noLiquidity:a,pcmMetadata:s,hasPassCode:u,pcmToken:c,retry:h}),{call:x,reset:y,retry:h,key:p}}),[e,t,n])}var G=n(80978),Q=n(46426),H=n(99510),V=n(77042);const Z={opacity:.2,pointerEvents:"none"},J=(0,d.A)((e=>({container:{width:"920px",backgroundColor:(0,R.g4)(e)?e.palette.background.level1:e.colors.lightGray50,borderRadius:e.radius,padding:"24px","@media(max-width: 960px)":{width:"460px",padding:"12px"}},topHeader:{paddingBottom:"12px",borderBottom:(0,R.g4)(e)?"1px solid #212946":"1px solid ".concat(e.colors.lightGray200BorderColor)},outerBox:{paddingTop:"24px",display:"grid",gap:"24px 48px",gridTemplateRows:"max-content",gridTemplateColumns:"1fr 1fr",gridAutoFlow:"row","@media(max-width: 960px)":{gridTemplateColumns:"1fr"}},priceRange:{gridArea:"1 / 2 / 3 / auto",height:"fit-content","@media(max-width: 960px)":{gridArea:"2 / 1 / 3 / auto"}}})));function $(){var e,t;const n=J(),d=(0,r.W6)(),R=(0,P.Le)();let{currencyIdA:M,currencyIdB:I,feeAmount:S}=(0,r.g)();M||(M=f.Bo);const[B,L]=(0,a.useState)(!1),[T]=(0,g.qK)("mint"),E=S?Number(S):f.dq,[q,F]=(0,v.rd)(M),[N,X]=(0,v.rd)(I),z=F&&X&&F.equals(X)?void 0:X,{independentField:O,typedValue:D,startPrice:K}=(0,h.Vs)(),{ticks:W,pricesAtTicks:$,invalidRange:ee,dependentField:te,parsedAmounts:ne,depositADisabled:ie,depositBDisabled:oe,ticksAtLimit:ae,errorMessage:re,position:se,invertPrice:ce,price:le,pool:de,noLiquidity:ue,currencyBalances:pe,atMaxAmounts:me,maxAmounts:xe,poolLoading:ye}=(0,h.Gm)(null!==F&&void 0!==F?F:void 0,null!==z&&void 0!==z?z:void 0,E,null!==F&&void 0!==F?F:void 0),he=!re&&!ee,{[f.zm.LOWER]:ge,[f.zm.UPPER]:ve}=W,{[f.zm.LOWER]:fe,[f.zm.UPPER]:ke}=$,Ce={[O]:D,[te]:null!==(e=null===(t=ne[te])||void 0===t?void 0:t.toExact())&&void 0!==e?e:""},{onFieldAInput:Ae,onFieldBInput:be,onLeftRangeInput:Re,onRightRangeInput:we,onStartPriceInput:je}=(0,h.R8)(),Pe=(0,h.Wk)(),_e=(0,a.useCallback)((()=>{Pe(),d.push("/swap/liquidity")}),[d,Pe]),Me=e=>{const t=e.canisterId.toString();t!==I&&I?d.push("/swap/liquidity/add/".concat(t,"/").concat(I)):d.push("/swap/liquidity/add/".concat(t))},Ie=e=>{const t=e.canisterId.toString();t!==M&&M?d.push("/swap/liquidity/add/".concat(M,"/").concat(t)):d.push("/swap/liquidity/add/".concat(t))},Se=(0,a.useCallback)((e=>{M&&I&&d.push("/swap/liquidity/add/".concat(M,"/").concat(I,"/").concat(e))}),[M,I]),Be=(0,a.useCallback)((()=>{Ae(""),be(""),Re(""),we(""),d.push("/swap/liquidity/add")}),[d,Ae,be,Re,we]),{getDecrementLower:Le,getIncrementLower:Te,getDecrementUpper:Ee,getIncrementUpper:qe,getSetFullRange:Fe}=(0,h.xh)(null!==F&&void 0!==F?F:void 0,null!==z&&void 0!==z?z:void 0,E,ge,ve,de),Ue=M&&I&&M!==I,Ne=(0,a.useCallback)((()=>{L(!0)}),[]),Xe=(0,C.F7)(),[ze,Oe]=(0,A.VS)(),[De]=(0,A.dX)(),{result:Ke}=(0,_.fh)(),{result:We}=(0,_.tX)(R),[,Ye]=(0,v.rd)(null===Ke||void 0===Ke?void 0:Ke.tokenCid.toString()),Ge=Y(),Qe=(0,a.useCallback)((async(e,t)=>{let{loading:n}=t;if(!e||n||!se||!R||!Ke||!Ye||void 0===We||null===We)return;const i=We<Ke.passcodePrice,{call:a,key:r}=await Ge({noLiquidity:ue,position:se,pcmMetadata:Ke,needPayForPCM:i,pcmToken:Ye,principal:R.toString(),openExternalTip:e=>{let{message:t,tipKey:n}=e;De((0,U.jsx)(H.e,{message:t,tipKey:n}))}}),s=ze(o.Ru._({id:"askRar",values:{0:null===F||void 0===F?void 0:F.symbol,1:null===z||void 0===z?void 0:z.symbol}}),{extraContent:(0,U.jsx)(G.A,{step:r})});L(!1);await a()?(Oe(s),_e()):Oe(s)}),[se,T,Xe,ue]),He=(0,a.useCallback)((()=>{L(!1)}),[]),Ve=(0,a.useMemo)((()=>ee||void 0===ge||void 0===ve||ue&&!K||ye),[ee,ge,ve,K,ue,ye]),Ze=()=>{var e,t,n,i,o;ae[f.zm.LOWER]||ae[f.zm.UPPER]||(Re(null!==(e=null===(t=ce?fe:null===ke||void 0===ke?void 0:ke.invert())||void 0===t?void 0:t.toSignificant(6))&&void 0!==e?e:""),we(null!==(n=null===(i=ce?ke:null===fe||void 0===fe?void 0:fe.invert())||void 0===i?void 0:i.toSignificant(6))&&void 0!==n?n:""),Ae(null!==(o=Ce[f.b_.CURRENCY_B])&&void 0!==o?o:""));d.push("/swap/liquidity/add/".concat(I,"/").concat(M).concat(E?"/".concat(E):""))},Je=()=>{const e=xe[f.b_.CURRENCY_A];F&&e&&Ae((0,w.O1)(e.toExact(),e.currency.decimals))},$e=()=>{const e=xe[f.b_.CURRENCY_B];X&&e&&be((0,w.O1)(e.toExact(),e.currency.decimals))};return(0,a.useEffect)((()=>()=>{Pe()}),[]),(0,U.jsx)(j.A,{onSubmit:Qe,children:e=>{var t,o,a,r;let{submit:d,loading:h}=e;return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(y.A,{children:(0,U.jsx)(s.Ay,{container:!0,justifyContent:"center",children:(0,U.jsxs)(s.Ay,{item:!0,className:n.container,children:[(0,U.jsxs)(s.Ay,{container:!0,className:n.topHeader,children:[(0,U.jsx)(s.Ay,{item:!0,xs:3,container:!0,alignItems:"center",children:(0,U.jsx)(u.A,{sx:{cursor:"pointer"},onClick:_e})}),(0,U.jsx)(s.Ay,{item:!0,xs:6,container:!0,justifyContent:"center",alignItems:"center",children:(0,U.jsx)(c.A,{variant:"h3",color:"textPrimary",align:"center",children:(0,U.jsx)(i.x6,{id:"OBdohg"})})}),(0,U.jsx)(s.Ay,{item:!0,container:!0,alignItems:"center",xs:3,sx:{position:"relative"},children:(0,U.jsx)(s.Ay,{item:!0,xs:!0,children:(0,U.jsx)(s.Ay,{container:!0,justifyContent:"flex-end",children:(0,U.jsx)(c.A,{sx:{cursor:"pointer"},color:"secondary",component:"span",onClick:Be,children:(0,U.jsx)(i.x6,{id:"LBPvuL"})})})})})]}),(0,U.jsxs)(l.A,{className:n.outerBox,children:[(0,U.jsxs)(l.A,{children:[(0,U.jsx)(c.A,{variant:"h4",color:"textPrimary",children:(0,U.jsx)(i.x6,{id:"/n/B7U"})}),(0,U.jsxs)(s.Ay,{container:!0,mt:2,spacing:"12px",children:[(0,U.jsx)(s.Ay,{item:!0,xs:6,children:(0,U.jsx)(m.A,{currencyId:M,onChange:Me,loading:q===v.s5.LOADING,disabledCurrency:[...F?[F]:[]]})}),(0,U.jsx)(s.Ay,{item:!0,xs:6,children:(0,U.jsx)(m.A,{currencyId:I,onChange:Ie,loading:N===v.s5.LOADING,disabledCurrency:[...z?[z]:[]]})})]}),(0,U.jsx)(l.A,{mt:2,sx:Ue?{}:Z,children:(0,U.jsx)(p.Ay,{defaultActiveFee:E,onSelect:Se,currencyA:F,currencyB:z})})]}),(0,U.jsxs)(l.A,{sx:Ve?Z:{},children:[(0,U.jsx)(c.A,{variant:"h4",color:"textPrimary",children:(0,U.jsx)(i.x6,{id:"Dqb0Bx"})}),(0,U.jsxs)(l.A,{mt:2,children:[(0,U.jsx)(l.A,{children:(0,U.jsx)(x.A,{currency:F,value:Ce[f.b_.CURRENCY_A],onUserInput:Ae,locked:ie,currencyBalance:null===pe||void 0===pe?void 0:pe[f.b_.CURRENCY_A],showMaxButton:!me[f.b_.CURRENCY_A]&&new b.A(null!==(t=null===(o=xe[f.b_.CURRENCY_A])||void 0===o?void 0:o.toExact())&&void 0!==t?t:0).isGreaterThan(0),onMax:Je})}),(0,U.jsx)(l.A,{mt:2,children:(0,U.jsx)(x.A,{currency:z,value:Ce[f.b_.CURRENCY_B],onUserInput:be,locked:oe,currencyBalance:null===pe||void 0===pe?void 0:pe[f.b_.CURRENCY_B],showMaxButton:!me[f.b_.CURRENCY_B]&&new b.A(null!==(a=null===(r=xe[f.b_.CURRENCY_B])||void 0===r?void 0:r.toExact())&&void 0!==a?a:0).isGreaterThan(0),onMax:$e})})]}),(0,U.jsx)(l.A,{mt:2,sx:{"@media(max-width: 959px)":{display:"block"},"@media(min-width: 960px)":{display:"none"}},children:(0,U.jsx)(Q.A,{size:"large",disabled:!he,error:re,onClick:Ne})})]}),(0,U.jsxs)(l.A,{className:n.priceRange,sx:Ue?{}:Z,children:[(0,U.jsx)(V.A,{poolLoading:ye,startPrice:K,noLiquidity:ue,onStartPriceInput:je,onLeftRangeInput:Re,onRightRangeInput:we,getDecrementLower:Le,getIncrementLower:Te,getDecrementUpper:Ee,getIncrementUpper:qe,getSetFullRange:Fe,handleTokenToggle:Ze,baseCurrency:F,quoteCurrency:z,ticksAtLimit:ae,feeAmount:E,priceLower:fe,priceUpper:ke,price:le?parseFloat((ce?le.invert():le).toSignificant(8)):void 0}),(0,U.jsx)(l.A,{mt:2,sx:{"@media(max-width:960px)":{display:"none"}},children:(0,U.jsx)(Q.A,{size:"large",disabled:!he||h,error:re,onClick:Ne})})]})]})]})})}),B&&!!se&&(0,U.jsx)(k.A,{onConfirm:d,onCancel:He,open:B,position:se})]})}})}},8157:(e,t,n)=>{n.d(t,{O:()=>d,Z:()=>l});var i=n(72296),o=n(85355),a=n(20361),r=n(65324),s=n(59155);const c=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{c(i.next(e))}catch(t){a(t)}}function s(e){try{c(i.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))};function l(e){return c(this,void 0,void 0,(function*(){return(0,a.Pk)(yield(yield(0,o.qy)()).getPasscodesByPrincipal(r.p.fromText(e))).data}))}function d(e,t){return(0,s.Pz)((0,i.useCallback)((()=>c(this,void 0,void 0,(function*(){if(e)return l(e)}))),[e]),t)}},65138:(e,t,n)=>{n.d(t,{Ct:()=>d,d5:()=>u,dE:()=>p,fh:()=>l,tX:()=>m});var i=n(72296),o=n(59155),a=n(85355),r=n(20361),s=n(65324),c=function(e,t,n,i){return new(n||(n=Promise))((function(o,a){function r(e){try{c(i.next(e))}catch(t){a(t)}}function s(e){try{c(i.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))};function l(){return(0,o.Pz)((0,i.useCallback)((()=>c(this,void 0,void 0,(function*(){return(0,r.Pk)(yield(yield(0,a.O2)()).metadata()).data}))),[]))}function d(e,t,n){return c(this,void 0,void 0,(function*(){const i=yield(yield(0,a.O2)(!0)).requestPasscode(e,t,n);return(0,r.Pk)(i)}))}function u(e,t){return c(this,void 0,void 0,(function*(){const n=yield(yield(0,a.O2)(!0)).withdraw({fee:t,amount:e});return(0,r.Pk)(n)}))}function p(e,t,n){return c(this,void 0,void 0,(function*(){const i=yield(yield(0,a.O2)(!0)).destoryPasscode(s.p.fromText(e),s.p.fromText(t),n);return(0,r.Pk)(i)}))}function m(e,t){return(0,o.Pz)((0,i.useCallback)((()=>c(this,void 0,void 0,(function*(){if(e)return(0,r.Pk)(yield(yield(0,a.O2)()).balanceOf(e)).data}))),[e]),t)}}}]);
//# sourceMappingURL=8715.b73aeb76.chunk.js.map